<div class="grid">
    <div class="col-12">
        <!-- En-tête avec bouton retour -->
        <div class="mb-4">
            <button pButton pRipple
                    icon="pi pi-arrow-left"
                    label="Retour"
                    class="p-button-text"
                    (click)="goBack()">
            </button>
        </div>

        <!-- Message de chargement -->
        <div *ngIf="loading" class="text-center p-5">
            <p-progressSpinner></p-progressSpinner>
            <p class="mt-3">Chargement de l'offre...</p>
        </div>

        <!-- Message d'erreur 404 -->
        <div *ngIf="notFound && !loading" class="text-center p-5">
            <div class="surface-card border-round p-6">
                <i class="pi pi-exclamation-circle text-4xl text-gray-400 mb-3"></i>
                <h3 class="text-gray-600">Offre non trouvée</h3>
                <p class="text-gray-500 mb-4">Cette offre n'existe pas ou a été supprimée.</p>
                <button pButton pRipple
                        label="Voir toutes les offres"
                        icon="pi pi-briefcase"
                        class="p-button-primary"
                        routerLink="/offers">
                </button>
            </div>
        </div>

        <!-- Contenu de l'offre -->
        <div *ngIf="offer && !loading" class="surface-card border-round">
            <p-toast></p-toast>
            <p-confirmDialog></p-confirmDialog>

            <!-- Bannière d'en-tête -->
            <div class="offer-header p-5 border-bottom-1 surface-border"
                 [ngClass]="{'bg-gradient-to-r from-blue-50 to-indigo-50': offer.isUrgent}">
                <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-start">
                    <!-- Titre et informations principales -->
                    <div class="flex-1">
                        <!-- Badges -->
                        <div class="flex flex-wrap gap-2 mb-3">
                            <span *ngIf="offer.isUrgent" class="badge badge-urgent">
                                <i class="pi pi-bolt mr-1"></i>Urgent
                            </span>
                            <span *ngIf="offer.isFeatured" class="badge badge-featured">
                                <i class="pi pi-star mr-1"></i>À la une
                            </span>
                            <span *ngIf="offer.remoteAllowed" class="badge badge-remote">
                                <i class="pi pi-wifi mr-1"></i>Télétravail possible
                            </span>
                            <span *ngIf="isOfferExpired()" class="badge badge-expired">
                                <i class="pi pi-clock mr-1"></i>Expirée
                            </span>
                            <span *ngIf="isRecruiterView" [class]="'badge ' + getStatusBadgeClass(offer.status)">
                                {{getStatusLabel(offer.status)}}
                            </span>
                        </div>

                        <!-- Titre -->
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
                            {{offer.title}}
                        </h1>

                        <!-- Entreprise et localisation -->
                        <div class="flex flex-wrap gap-4 mb-4">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-building text-gray-500"></i>
                                <span class="text-lg font-semibold">{{offer.companyName || 'Entreprise non spécifiée'}}</span>
                            </div>
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-map-marker text-gray-500"></i>
                                <span class="text-lg">{{offer.city}}, {{offer.country}}</span>
                            </div>
                        </div>

                        <!-- Métadonnées -->
                        <div class="grid">
                            <div class="col-6 md:col-3">
                                <div class="text-sm text-gray-900">Type de contrat</div>
                                <div class="font-medium">{{getJobTypeLabel(offer.jobType)}}</div>
                            </div>
                            <div class="col-6 md:col-3">
                                <div class="text-sm text-gray-900">Salaire</div>
                                <div class="font-bold text-green-700">{{getSalaryRange()}}</div>
                            </div>
                            <div class="col-6 md:col-3">
                                <div class="text-sm text-gray-900">Expérience</div>
                                <div class="font-medium">{{offer.experienceRequired || 0}} an(s) minimum</div>
                            </div>
                            <div class="col-6 md:col-3">
                                <div class="text-sm text-gray-900">Niveau d'étude</div>
                                <div class="font-medium">{{offer.educationLevel || 'Non spécifié'}}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions principales -->
                    <div class="mt-4 md:mt-0 md:ml-4">
                        <div class="flex flex-column gap-3">
                            <button
                                    pButton pRipple
                                    label="Modifier l'offre"
                                    icon="pi pi-pencil"
                                    class="p-button-warning p-button-lg w-full"
                                    (click)="editOffer()">
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contenu principal -->
            <div class="p-5">
                <div class="grid">
                    <!-- Colonne gauche : Description et exigences -->
                    <div class="col-12 lg:col-8">
                        <!-- Description -->
                        <div class="mb-6">
                            <h3 class="text-xl font-bold mb-3">
                                <i class="pi pi-align-left mr-2 text-blue-500"></i>
                                Description du poste
                            </h3>
                            <div class="prose max-w-none">
                                <p class="whitespace-pre-line text-gray-700 leading-relaxed">
                                    {{offer.description}}
                                </p>
                            </div>
                        </div>

                        <!-- Exigences et responsabilités -->
                        <div class="mb-6" *ngIf="offer.requirements">
                            <h3 class="text-xl font-bold mb-3">
                                <i class="pi pi-list-check mr-2 text-green-500"></i>
                                Exigences et responsabilités
                            </h3>
                            <ul class="list-none p-0">
                                <li *ngFor="let requirement of getRequirementsArray()"
                                    class="flex align-items-start mb-2">
                                    <i class="pi pi-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span class="flex-1">{{requirement}}</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Compétences requises -->
                        <div class="mb-6" *ngIf="getSkillsArray().length > 0">
                            <h3 class="text-xl font-bold mb-3">
                                <i class="pi pi-tags mr-2 text-purple-500"></i>
                                Compétences requises
                            </h3>
                            <div class="flex flex-wrap gap-2">
                                <span *ngFor="let skill of getSkillsArray()"
                                      class="skill-pill">
                                    {{skill}}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Colonne droite : Informations complémentaires -->
                    <div class="col-12 lg:col-4">
                        <div class="surface-section border-round p-4">
                            <!-- Détails de l'offre -->
                            <h4 class="text-lg font-bold mb-4">
                                <i class="pi pi-info-circle mr-2"></i>
                                Détails de l'offre
                            </h4>

                            <div class="space-y-4">
                                <!-- Date de début -->
                                <div>
                                    <div class="text-sm text-gray-500">Date de début</div>
                                    <div class="font-medium">
                                        <i class="pi pi-calendar mr-2 text-blue-500"></i>
                                        {{formatDate(offer.startDate)}}
                                    </div>
                                </div>

                                <!-- Date limite de candidature -->
                                <div>
                                    <div class="text-sm text-gray-500">Date limite</div>
                                    <div [ngClass]="{'font-bold text-red-600': isOfferExpired(), 'font-medium': true}">
                                        <i class="pi pi-clock mr-2 text-orange-500"></i>
                                        {{formatDate(offer.applicationDeadline)}}
                                        <span class="block text-sm mt-1" [ngClass]="{'text-red-600': isOfferExpired(), 'text-gray-600': !isOfferExpired()}">
                                            {{getTimeRemaining()}}
                                        </span>
                                    </div>
                                </div>

                                <!-- Recruteur -->
                                <div>
                                    <div class="text-sm text-gray-500">Publiée par</div>
                                    <div class="font-medium">
                                        <i class="pi pi-user mr-2 text-green-500"></i>
                                        {{offer.recruiterName}}
                                    </div>
                                </div>

                                <!-- Statut de publication -->
                                <div *ngIf="isRecruiterView">
                                    <div class="text-sm text-gray-500">Statut</div>
                                    <div class="font-medium">
                                        <span [class]="'badge ' + getStatusBadgeClass(offer.status)">
                                            {{getStatusLabel(offer.status)}}
                                        </span>
                                        <div *ngIf="offer.publishedAt" class="text-xs text-gray-500 mt-1">
                                            Publié le: {{formatDateTime(offer.publishedAt)}}
                                        </div>
                                    </div>
                                </div>

                                <!-- Métriques -->
                                <div class="pt-4 border-top-1">
                                    <h5 class="font-bold mb-3">Statistiques</h5>
                                    <div class="grid">
                                        <div class="col-6">
                                            <div class="text-center p-3 surface-hover border-round">
                                                <i class="pi pi-eye text-2xl text-blue-500 mb-2"></i>
                                                <div class="text-xl font-bold">{{offer.viewsCount || 0}}</div>
                                                <div class="text-sm text-gray-600">Vues</div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center p-3 surface-hover border-round">
                                                <i class="pi pi-users text-2xl text-green-500 mb-2"></i>
                                                <div class="text-xl font-bold">{{offer.applicationsCount || 0}}</div>
                                                <div class="text-sm text-gray-600">Candidatures</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Actions rapides pour recruteur -->
                                <div *ngIf="isRecruiterView" class="pt-4 border-top-1">
                                    <h5 class="font-bold mb-3">Actions rapides</h5>
                                    <div class="flex flex-column gap-2">
                                        <button pButton pRipple
                                                [label]="offer.status === 'PUBLISHED' ? 'Fermer l\'offre' : 'Publier l\'offre'"
                                                [icon]="offer.status === 'PUBLISHED' ? 'pi pi-lock' : 'pi pi-globe'"
                                                [class]="offer.status === 'PUBLISHED' ? 'p-button-secondary' : 'p-button-primary'"
                                                (click)="toggleOfferStatus()"
                                                class="w-full">
                                        </button>

                                        <button pButton pRipple
                                                [label]="offer.isUrgent ? 'Retirer urgent' : 'Marquer urgent'"
                                                [icon]="offer.isUrgent ? 'pi pi-clock' : 'pi pi-bolt'"
                                                [class]="offer.isUrgent ? 'p-button-outlined' : 'p-button-help'"
                                                (click)="toggleUrgentFlag()"
                                                class="w-full">
                                        </button>

                                        <button pButton pRipple
                                                [label]="offer.isFeatured ? 'Retirer mise en avant' : 'Mettre en avant'"
                                                icon="pi pi-star"
                                                [class]="offer.isFeatured ? 'p-button-outlined' : 'p-button-warning'"
                                                (click)="toggleFeaturedFlag()"
                                                class="w-full">
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton CTA pour mobile -->
                        <div class="mt-4 lg:hidden">
                            <button *ngIf="canApply && !hasApplied && !isOfferExpired()"
                                    pButton pRipple
                                    label="Postuler maintenant"
                                    icon="pi pi-send"
                                    class="p-button-success w-full p-button-lg">
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pied de page avec actions supplémentaires -->
            <div class="border-top-1 surface-border p-5">
                <div class="flex flex-wrap justify-content-between align-items-center">
                    <div class="text-gray-600">
                        <small>
                            Offre créée le {{formatDateTime(offer.createdAt)}} •
                            Dernière mise à jour: {{formatDateTime(offer.updatedAt)}}
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Offres similaires -->
        <div *ngIf="similarOffers.length > 0 && !loading" class="mt-6">
            <div class="surface-card border-round p-5">
                <h3 class="text-xl font-bold mb-4">
                    <i class="pi pi-briefcase mr-2"></i>
                    Offres similaires
                </h3>

                <div class="grid">
                    <div class="col-12 md:col-6 lg:col-3" *ngFor="let similarOffer of similarOffers">
                        <div class="surface-hover border-round p-4 h-full cursor-pointer"
                             (click)="router.navigate(['/offers', similarOffer.id])">
                            <div class="flex flex-column h-full">
                                <div class="mb-2">
                                    <span class="badge badge-job-type">
                                        {{getJobTypeLabel(similarOffer.jobType)}}
                                    </span>
                                </div>

                                <h4 class="font-bold text-gray-900 line-clamp-2 mb-2">
                                    {{similarOffer.title}}
                                </h4>

                                <div class="text-gray-600 text-sm mb-3">
                                    {{similarOffer.companyName}}
                                </div>

                                <div class="flex gap-2 mb-3">
                                    <span class="text-sm">
                                        <i class="pi pi-map-marker text-gray-500 mr-1"></i>
                                        {{similarOffer.city}}
                                    </span>
                                    <span class="text-sm">
                                        <i class="pi pi-money-bill text-gray-500 mr-1"></i>
                                        {{similarOffer.salaryMin.toLocaleString('fr-FR')}}+
                                    </span>
                                </div>

                                <div class="mt-auto">
                                    <button pButton pRipple
                                            label="Voir l'offre"
                                            icon="pi pi-eye"
                                            class="p-button-outlined p-button-sm w-full">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Style d'impression -->
<style>
    @media print {
        .p-button,
        .offer-actions,
        .similar-offers {
            display: none !important;
        }

        .offer-header {
            background: white !important;
        }
    }
</style>
