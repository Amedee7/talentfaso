<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">
            <p-toast></p-toast>

            <!-- En-tête -->
            <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center mb-6">
                <div>
                    <h2 class="m-0">
                        <i class="pi pi-bell mr-2"></i>
                        Notifications
                    </h2>
                    <p class="text-gray-600 mt-2">
                        Gérez vos notifications et restez informé
                    </p>
                </div>

                <div class="mt-3 md:mt-0">
                    <button pButton pRipple
                            label="Tout marquer comme lu"
                            icon="pi pi-check-circle"
                            class="p-button-success"
                            (click)="markAllAsRead()"
                            [disabled]="!stats?.hasUnread || loading">
                    </button>

                    <button pButton pRipple
                            label="Supprimer les lues"
                            icon="pi pi-trash"
                            class="p-button-outlined ml-2"
                            (click)="deleteAllRead()"
                            [disabled]="!stats?.readCount || loading">
                    </button>
                </div>
            </div>

            <!-- Statistiques -->
            <div class="mb-6" *ngIf="stats">
                <div class="grid">
                    <div class="col-6 md:col-3">
                        <div class="surface-card p-4 border-round text-center">
                            <i class="pi pi-inbox text-blue-500 text-2xl mb-2"></i>
                            <div class="text-900 font-bold text-xl">{{stats.totalNotifications}}</div>
                            <div class="text-600">Total</div>
                        </div>
                    </div>
                    <div class="col-6 md:col-3">
                        <div class="surface-card p-4 border-round text-center">
                            <i class="pi pi-eye text-green-500 text-2xl mb-2"></i>
                            <div class="text-900 font-bold text-xl">{{stats.readCount}}</div>
                            <div class="text-600">Lues</div>
                        </div>
                    </div>
                    <div class="col-6 md:col-3">
                        <div class="surface-card p-4 border-round text-center">
                            <i class="pi pi-eye-slash text-orange-500 text-2xl mb-2"></i>
                            <div class="text-900 font-bold text-xl">{{stats.unreadCount}}</div>
                            <div class="text-600">Non lues</div>
                        </div>
                    </div>
                    <div class="col-6 md:col-3">
                        <div class="surface-card p-4 border-round text-center">
                            <i class="pi pi-exclamation-circle text-red-500 text-2xl mb-2"></i>
                            <div class="text-900 font-bold text-xl">{{stats.hasUnread ? 'Oui' : 'Non'}}</div>
                            <div class="text-600">Non lues ?</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filtres -->
            <div class="mb-6 p-4 surface-ground border-round">
                <h5 class="mt-0 mb-4">Filtres</h5>

                <div class="grid">
                    <!-- Type de notification -->
                    <div class="col-12 md:col-6 lg:col-4">
                        <label class="block mb-2 font-medium">Type de notification</label>
                        <p-multiSelect [options]="notificationTypes"
                                       [(ngModel)]="selectedTypes"
                                       optionLabel="label"
                                       optionValue="value"
                                       placeholder="Tous les types"
                                       class="w-full">
                        </p-multiSelect>
                    </div>

                    <!-- Non lues seulement -->
                    <div class="col-12 md:col-6 lg:col-4">
                        <div class="field-checkbox mt-4">
                            <p-checkbox [(ngModel)]="filterUnread"
                                        [binary]="true"
                                        inputId="unreadOnly">
                            </p-checkbox>
                            <label for="unreadOnly" class="ml-2">Non lues seulement</label>
                        </div>
                    </div>
                </div>

                <!-- Boutons des filtres -->
                <div class="flex justify-content-end gap-2 mt-4">
                    <button pButton pRipple
                            label="Réinitialiser"
                            icon="pi pi-refresh"
                            class="p-button-text"
                            (click)="resetFilters()"
                            [disabled]="loading">
                    </button>

                    <button pButton pRipple
                            label="Appliquer"
                            icon="pi pi-check"
                            class="p-button-primary"
                            (click)="applyFilters()"
                            [disabled]="loading">
                    </button>
                </div>
            </div>

            <!-- Liste des notifications -->
            <div class="notifications-container">
                <div *ngIf="loading" class="text-center p-5">
                    <p-progressSpinner></p-progressSpinner>
                    <p class="mt-3">Chargement des notifications...</p>
                </div>

                <div *ngIf="!loading && filteredNotifications.length === 0" class="text-center p-5">
                    <i class="pi pi-bell text-4xl text-gray-400 mb-3"></i>
                    <h4 class="text-gray-500 mb-2">Aucune notification</h4>
                    <p class="text-gray-400">Vous n'avez aucune notification pour le moment</p>
                </div>

                <div *ngFor="let notification of filteredNotifications"
                     class="notification-card mb-3"
                     [class.unread]="!notification.isRead">
                    <div class="flex">
                        <!-- Icône -->
                        <div class="notification-icon mr-4">
                            <i [class]="getNotificationIcon(notification.type)" class="text-2xl"></i>
                        </div>

                        <!-- Contenu -->
                        <div class="flex-1">
                            <div class="flex justify-content-between align-items-start">
                                <div>
                                    <h4 class="m-0">{{notification.title}}</h4>
                                    <div class="flex align-items-center gap-2 mt-1">
                    <span class="notification-type-badge">
                      {{getNotificationTypeLabel(notification.type)}}
                    </span>
                                        <span class="text-xs text-gray-500">
                      {{notification.createdAt | date:'dd/MM/yyyy HH:mm'}}
                    </span>
                                        <span *ngIf="!notification.isRead" class="unread-badge">
                      <i class="pi pi-circle-fill mr-1"></i>Non lue
                    </span>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="flex gap-1">
                                    <button pButton pRipple
                                            icon="pi pi-check"
                                            class="p-button-success p-button-sm"
                                            *ngIf="!notification.isRead"
                                            (click)="markAsRead(notification)"
                                            pTooltip="Marquer comme lu">
                                    </button>

                                    <button pButton pRipple
                                            icon="pi pi-trash"
                                            class="p-button-danger p-button-sm"
                                            (click)="deleteNotification(notification)"
                                            pTooltip="Supprimer">
                                    </button>
                                </div>
                            </div>

                            <p class="mt-3 text-gray-700">{{notification.message}}</p>

                            <!-- Actions spécifiques -->
                            <div *ngIf="notification.actionUrl" class="mt-3">
                                <button pButton pRipple
                                        label="Voir les détails"
                                        icon="pi pi-external-link"
                                        class="p-button-outlined p-button-sm">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div *ngIf="!loading && filteredNotifications.length > 0" class="mt-4">
                <p-paginator [rows]="pageSize"
                             [totalRecords]="totalNotifications"
                             [rowsPerPageOptions]="[10, 20, 50]"
                             (onPageChange)="onPageChange($event)">
                </p-paginator>
            </div>
        </div>
    </div>
</div>
